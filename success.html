<!-- success.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Successful - PhotoStock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="min-h-screen flex items-center justify-center">
        <div id="main-content" class="text-center bg-white p-10 rounded-lg shadow-2xl max-w-lg mx-auto">
            <!-- Initial Loading State -->
            <h1 class="text-3xl font-bold text-gray-900 mt-4">Verifying your purchase...</h1>
            <p class="text-gray-600 mt-2">Please wait while we confirm your payment.</p>
        </div>
    </div>

    <script>
        const API_URL = 'https://imagestock-shop.onrender.com';
        const mainContent = document.getElementById('main-content');

        const verifyPurchase = async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');

            if (!sessionId) {
                showError();
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/fulfill-order`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionId: sessionId })
                });

                const orderDetails = await response.json();

                if (orderDetails.success) {
                    showSuccess(orderDetails);
                } else {
                    showError(orderDetails.message);
                }

            } catch (error) {
                console.error('Verification Error:', error);
                showError();
            }
        };

        const showSuccess = (details) => {
            mainContent.innerHTML = `
                <svg class="w-16 h-16 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h1 class="text-3xl font-bold text-gray-900 mt-4">Thank You!</h1>
                <p class="text-gray-600 mt-2">Your purchase was successful. You can now download the original, high-resolution image.</p>
                <div class="mt-8">
                    <img src="${details.downloadUrl}" alt="${details.imageName}" class="mx-auto rounded-lg shadow-md max-h-60">
                    <h2 class="text-xl font-semibold mt-4">${details.imageName}</h2>
                </div>
                <div class="mt-8">
                    <a href="${details.downloadUrl}" download class="inline-block w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700">
                        Download Image
                    </a>
                    <a href="index.html" class="mt-4 inline-block text-indigo-600 hover:underline">Back to Gallery</a>
                </div>
            `;
        };

        const showError = (message = 'Could not verify your purchase.') => {
            mainContent.innerHTML = `
                <h1 class="text-3xl font-bold text-red-600 mt-4">Payment Error</h1>
                <p class="text-gray-600 mt-2">${message} Please check your email for a receipt or contact support.</p>
                <a href="index.html" class="mt-8 inline-block text-indigo-600 hover:underline">Back to Gallery</a>
            `;
        };

        verifyPurchase();
    </script>
</body>
</html>
